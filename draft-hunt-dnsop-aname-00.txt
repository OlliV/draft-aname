



Network Working Group                                            E. Hunt
Internet-Draft                                                       ISC
Intended status: Standards Track                             P. van Dijk
Expires: September 26, 2017                             PowerDNS.co B.V.
                                                          March 25, 2017


             Address-specific DNS Name Redirection (ANAME)
                       draft-hunt-dnsop-aname-00

Abstract

   This document proposes a new DNS RR type ANAME, which provides
   similar functionality to CNAME but is specific to address queries
   (type A and AAAA), and can coexist with other record types at a zone
   apex.  This allows zone owners to redirect queries for apex domain
   names without violating specifications that require CNAME not to
   coexist with other RR types such as NS and SOA.

Status of This Memo

   This Internet-Draft is submitted in full conformance with the
   provisions of BCP 78 and BCP 79.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF).  Note that other groups may also distribute
   working documents as Internet-Drafts.  The list of current Internet-
   Drafts is at http://datatracker.ietf.org/drafts/current/.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   This Internet-Draft will expire on September 26, 2017.

Copyright Notice

   Copyright (c) 2017 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to BCP 78 and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (http://trustee.ietf.org/license-info) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of



Hunt & van Dijk        Expires September 26, 2017               [Page 1]

Internet-Draft                    aname                       March 2017


   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.

Table of Contents

   1.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   2
     1.1.  Reserved Words  . . . . . . . . . . . . . . . . . . . . .   3
   2.  The ANAME RR Type . . . . . . . . . . . . . . . . . . . . . .   3
   3.  Authoritative Server Behavior . . . . . . . . . . . . . . . .   3
     3.1.  Address records returned with ANAME . . . . . . . . . . .   3
     3.2.  Coexistence with other types  . . . . . . . . . . . . . .   4
     3.3.  DNSSEC signing  . . . . . . . . . . . . . . . . . . . . .   4
   4.  Recursive Server Behavior . . . . . . . . . . . . . . . . . .   4
   5.  Operational Considerations  . . . . . . . . . . . . . . . . .   5
   6.  Security Considerations . . . . . . . . . . . . . . . . . . .   5
   7.  IANA Considerations . . . . . . . . . . . . . . . . . . . . .   5
   8.  Acknowledgments . . . . . . . . . . . . . . . . . . . . . . .   5
   9.  References  . . . . . . . . . . . . . . . . . . . . . . . . .   5
     9.1.  Normative References  . . . . . . . . . . . . . . . . . .   5
     9.2.  Informative References  . . . . . . . . . . . . . . . . .   6
   Authors' Addresses  . . . . . . . . . . . . . . . . . . . . . . .   6

1.  Introduction

   Websites hosted by content distribution networks are often served by
   multiple IP addresses handling different geographic areas.  In some
   cases, the initial query for a domain name returns a CNAME record
   whose <target> is a name served by the CDN, which ultimately resolves
   to a different answer depending on the client's address.

   This method works with ordinary DNS nodes (for example,
   "www.example.com") but fails at zone apex nodes (such as
   "example.com"), because CNAME records are forbidden by [RFC1033] and
   [RFC1034] to coexist with other RR types such as SOA, NS, DNSKEY, MX,
   TXT/SPF, etc.  ([RFC4034] specifies exceptions for some RR types such
   as NSEC and RRSIG, which are automatically returned alongside CNAME
   responses and are not generally queried for directly.  Such
   exceptions are not realistic for most other query types; if a
   recursive resolver with a cached CNAME received a query for MX or
   DNSKEY, it would follow the CNAME, and would not find the correct
   answer.)

   This document proposes a new RR type "ANAME", which provides similar
   functionality to CNAME but only for address queries (type A and
   AAAA).  The ANAME record can be present at any DNS node, and can
   coexist with other RR types at a zone apex.





Hunt & van Dijk        Expires September 26, 2017               [Page 2]

Internet-Draft                    aname                       March 2017


1.1.  Reserved Words

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in [RFC2119].

2.  The ANAME RR Type

   This document specifies a new DNS resource record type ANAME, with RR
   code point [TBD].  The presentation format is identical to that of
   CNAME [RFC1033].  The wire format is also identical to CNAME, except
   that name compression is not permitted in ANAME RDATA per [RFC3597].

   No more than one ANAME resource record can be present at any DNS
   node.

3.  Authoritative Server Behavior

   When an ANAME record is present at a DNS node and a query is received
   by an authoritative server for type A or AAAA, the authoritative
   server returns the ANAME RRset in the answer section.  For the
   benefit of querying resolvers that do not implement ANAME, the
   authoritative server also returns address records as described below.
   (This is similar to the synthesized CNAME record included with DNAME
   [RFC6672].)

3.1.  Address records returned with ANAME

   If the original query is for type A, and an A RRset exists at the
   ANAME <target>, then that A RRset (with <owner> changed to match that
   of the ANAME RR), MUST be appended to the answer section after the
   ANAME RRset.  If an AAAA RRset eixsts at the ANAME <target>, then it
   MAY be appended to the additional section (again, with <owner>
   changed to match that of the ANAME RR).

   Similarly, if the original query was for type AAAA, and an AAAA RRset
   exists at the ANAME <target>, then it is appended to the answer
   section, and if an A RRset also exists at the ANAME <target> then it
   MAY be appended to the additional section.

   How and when an authoritative server resolves the A and AAAA
   responses from the ANAME <target> (when it is not itself
   authoritative for <target>) is unspecified.  If an authoritative
   server is capable of recursion, then it MAY perform recursion itself,
   or it MAY send A and AAAA queries to an external resolver.  It MAY
   resolve A and AAAA when loading the zone and cache the responses (in
   which case it MUST periodically refresh them when their TTLs expire),
   or it MAY delay resolution of the A and AAAA at the ANAME <target>



Hunt & van Dijk        Expires September 26, 2017               [Page 3]

Internet-Draft                    aname                       March 2017


   until an address query is received for the ANAME <owner>.  (In either
   case, for peformance reasons, it is RECOMMENDED that the
   authoritative server cache the A and AAAA responses.)

   If the original query is for type ANAME, A and AAAA records MAY be
   returned in the additional section.

   The TTL for the A and/or AAAA RRsets MUST be set to the lesser of the
   ANAME TTL and the TTL of the A and/or AAAA RRsets at the ANAME
   <target>.  The TTL of cached A and/or AAAA RRsets MUST count down,
   just as they do in a resolver cache.

   If an A or AAAA RRset is included in the answer section which was
   resolved from a source for which the server is not authoritative,
   then the AA ("authoritative answer") bit in the DNS response header
   MUST be clear.

3.2.  Coexistence with other types

   If the zone is configured with an A RRset at the same node as ANAME,
   then the ANAME MUST NOT be returned for queries of type A.
   Similarly, if ANAME coexists with AAAA, then ANAME MUST NOT be
   returned for queries of type AAAA.  If ANAME coexists with both A and
   AAAA RRsets, then ANAME is never returned.  If a zone is configured
   with all three of ANAME, A, and AAAA at the same node, the server MAY
   treat this as an error condition and reject the zone.

   ANAME can freely coexist with all other RR types.

3.3.  DNSSEC signing

   If the zone is DNSSEC signed, and if the server has access to the
   private key, then the A and AAAA RRsets SHOULD be signed.  Note that
   validating resolvers which do not yet implement ANAME will be unable
   to validate A and AAAA responses included with an ANAME response.
   Consequently, deployment of ANAME in signed zones when the private
   key is not accessible to the server is not recommended.

4.  Recursive Server Behavior

   When a recursive resolver sends a query of type A or AAAA and
   receives a response with an ANAME RRset in the answer section, it
   MUST re-query for the ANAME <target>, disregarding any addresses that
   were included with the response.  This is necessary because, in some
   cases, the final address will be dependent on network topology and
   other considerations, and the resolver will find a different answer
   than the authoritative server did.  If configured to do so, the
   resolver MAY include an EDNS CLIENT-SUBNET option when re-querying



Hunt & van Dijk        Expires September 26, 2017               [Page 4]

Internet-Draft                    aname                       March 2017


   for the ANAME <target> and cache the response accordingly (see
   [RFC7871]).

5.  Operational Considerations

   When a zone containing ANAME records is transferred to a secondary
   server, the ANAME records are transferred but the A or AAAA records
   retrieved from the ANAME <target> are not.  If the primary server
   implements ANAME but the secondary server does not, then the two will
   return different answers for address queries.  It is therefore
   recommended that ANAME not be deployed in a zone unless all of the
   authoritative servers for that zone implement ANAME.

6.  Security Considerations

   An authoritative server which implements ANAME must resolve address
   queries on behalf its clients, either internally or by querying an
   external resolver.  Resolution takes place regardless of whether the
   client would ordinaily be permitted by local policy to send recursive
   queries.

   When a resolver that does not understand ANAME receives a response
   containing A or AAAA records with <owner> rewritten to match that of
   the ANAME RR, this may bypass security based on local policy limiting
   access to the original ANAME <target>.

   A validating resolver that does not understand ANAME will not be able
   to validate A and AAAA records unless they are signed.

7.  IANA Considerations

   IANA is requested to allocate a DNS RR type number for the ANAME RR
   type.

8.  Acknowledgments

   Thanks to Mukund Sivaraman, Ray Bellis, and Mark Andrews for
   discussion and feedback.

9.  References

9.1.  Normative References

   [RFC1033]  Lottor, M., "Domain administrators operations guide",
              RFC 1033, November 1987.

   [RFC1034]  Mockapetris, P., "Domain names - concepts and facilities",
              STD 13, RFC 1034, November 1987.



Hunt & van Dijk        Expires September 26, 2017               [Page 5]

Internet-Draft                    aname                       March 2017


   [RFC3597]  Gustafsson, A., "Handling of Unknown DNS Resource Record
              (RR) Types", RFC 3597, September 2003.

   [RFC4034]  Arends, R., Austein, R., Larson, M., Massey, D., and S.
              Rose, "Resource Records for the DNS Security Extensions",
              RFC 4034, March 2005.

9.2.  Informative References

   [RFC2119]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", BCP 14, RFC 2119, March 1997.

   [RFC6672]  Rose, S. and W. Wijngaards, "DNAME Redirection in the
              DNS", RFC 6672, June 2012.

   [RFC7871]  Contavalli, C., van der Gaast, W., Lawrence, D., and W.
              Kumari, "Client Subnet in DNS Queries", RFC 7871,
              DOI 10.17487/RFC7871, May 2016,
              <http://www.rfc-editor.org/info/rfc7871>.

Authors' Addresses

   Evan Hunt
   ISC
   950 Charter St
   Redwood City, CA  94063
   USA

   Email: each@isc.org


   Peter van Dijk
   PowerDNS.co B.V.
   Seinstraat 76
   Hilversum  1223 DB
   The Netherlands

   Email: peter.van.dijk@powerdns.com













Hunt & van Dijk        Expires September 26, 2017               [Page 6]
